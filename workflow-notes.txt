1. Download data via links on spreadsheet
2. Extract CDS for TGIGA with degenotate
3. isofilter
3. Combine sequences: 
    - find . -type f -name *.fa -exec cat {} \; > spider-16spec-peptides.fa
    - find . -type f -name *-isoforms.fa -exec cat {} \; > chelicerate-19spec-peptides.fa
4. Make blast databse: 
    - makeblastdb -in ../isofilter/spider-16spec-peptides.fa -dbtype prot -out spider-16spec-blastdb
    - makeblastdb -in ../isofilter/chelicerate-19spec-peptides.fa -dbtype prot -out chelicerate-19spec-blastdb
5. BLAST: run_blash.sh
    - 95556641 hits
6. Filter BLAST output by e-val: 
    - grep -v "#" spider-16spec-blast-output.txt | awk '{if($11 <= 1e-3){print}}' > spider-16spec-blast-output-1e-3.txt
    - 68559308 hits
    - grep -v "#" chelicerate-19spec-blast-output.txt | awk '{if($11 <= 1e-3){print}}' > chelicerate-19spec-blast-output-1e-3.txt
    - 91116793 hits
7. FastOrtho: run_fastortho.sh
8. summarize_fastortho.py
9. Get the sequences for each cluster with get_orths.py
    - This also saves the clusters with at least 4 taxa represented: 11983
10. Snakemake CDS alignment pipeline:
    i.      Guidance
    ii.     Trim/filter and translate alignments with aln_filter.py
            time -p python aln_filter.py -i /n/holylfs05/LABS/informatics/Users/gthomas/spiders/aln/01-Guidance/ -o /n/holylfs05/LABS/informatics/Users/gthomas/spiders/aln/02-Filter/ --overwrite
11. Gene trees with iqtree_gt_gen.py
12. Make gene to species map with gene_to_species_map.py for ASTRAL-Pro and ASTRAL
    - python gene_to_species_map.py
    - One line per gene for ASTRAL-pro, one line per species for ASTRAL
13. Root gene trees:
    - time -p python root_gene_trees.py
    - Also writes single-copy gene trees.
14. Infer species tree
    A. Run ASTRAL-pro:
        - time -p astral-pro -a gene-to-spec-map.txt -o chelicerate-16spec-astral-pro.tre ../loci.treefile 2> astral-pro.log
    B. Run ASTRAL on single-copy groups:
        - cat single copy trees from step 13 into a single file
        - time -p astral -i loci-single-copy.treefile -o chelicerate-16spec-astral-single-copy.tre 2> astral.log
    C. Run ASTRAL-multi:
        - First, re-label/map the gene trees so they don't take up too much memory: time -p astral -i ../loci.treefile -a gene-to-spec-map-single-line.txt -o loci-relabeled.treefile -R > gene-to-spec-remap.txt
        - time -p astral -i loci-relabeled.treefile -a gene-to-spec-remap.txt -o chelicerate-16spec-astral-multi.tre 2> astral.log
15. Root the species trees: nw_reroot -l <species tree file> DMELA BMORI > <rooted species tree file>
16. Bootstrap rearrange gene trees:
    - time -p notung -b /n/holylfs05/LABS/informatics/Users/gthomas/spiders/tree/cds-iqtree/loci-filenames-st.txt --absfilenames --rearrange --speciestag postfix --threshold 70 --edgeweights name --treeoutput newick --nolosses --outputdir astral-pro-tree/loci-rearrange-70/ 2> astral-pro-tree/loci-rearrange-70.log
17. GRAMPA







12. Root gene trees with root_gene_trees.py
13. Check for empty rooted gene tree files
    - find . -type f -name *.rooted.treefile -empty
    - Add -delete to remove
14. Get filenames for Notung:
    - find . -type f -name *.rooted.treefile > ../loci-rooted-filenames.txt
    - Add species tree to beginning of loci-rooted-filenames.txt
15. Run bootstrap rearrangement with Notung
    - time -p java -jar Notung-2.9.1.5.jar -b /n/holylfs05/LABS/informatics/Users/gthomas/spiders/tree/cds-iqtree/loci-rooted-filenames-st.txt --rearrange --speciestag postfix --threshold 70 --edgeweights name --absfilenames --treeoutput newick --nolosses
    - move rearragned gene tree files to loci-rearrange
    - cat all trees in loci-rearrange to loci-rooted-rearrange.treefile










12. Make gene to species map with gene_to_species_map.py for ASTRAL-Pro
13. Root gene trees: root_gene_trees.py
    # find . -type f -name "*.treefile" | while read FILE; do newfile="$(echo ${FILE} | sed -e 's/.treefile/.rooted.treefile/g')" ; nw_reroot -l "${FILE}" DMELA BMORI > "${newfile}"; done
    - Remove empty files that couldn't be rooted find . -type f -name *.rooted.treefile -empty
14. Notung bootstrap rearrangement /n/holylfs05/LABS/informatics/Users/gthomas/spiders/tree/cds-iqtree/loci-rooted-filenames.txt
13. Run ASTRAL-Pro: ./astral-pro -a /n/holylfs05/LABS/informatics/Users/gthomas/spiders/tree/cds-iqtree/gene-to-spec-map.txt -o ap-test /n/holylfs05/LABS/informatics/Users/gthomas/spiders/tree/cds-iqtree/loci.treefile
    - Note: Java version didn't work, used C++ version (https://github.com/chaoszhang/ASTER/)
